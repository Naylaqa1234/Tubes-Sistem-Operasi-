<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulasi Parbegin‚ÄìParend</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#6EE7B7; --muted:#94A3B8; --glass: rgba(255,255,255,0.03);
      --success:#34D399; --danger:#FB7185; --panel:#0b1220;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: linear-gradient(180deg,#091024 0%, #071427 100%);
      color:#E6EEF3;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      gap:20px;
    }

    .app {
      width:100%;
      max-width:980px;
      border-radius:14px;
      padding:20px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 6px 30px rgba(2,6,23,0.6);
      border: 1px solid rgba(255,255,255,0.03);
    }

    header{
      display:flex;
      gap:16px;
      align-items:center;
      margin-bottom:10px;
    }
    .logo{
      width:56px;height:56px;border-radius:10px;
      background:linear-gradient(135deg,var(--accent),#60A5FA);
      display:flex;align-items:center;justify-content:center;
      color:#052024;font-weight:700;font-size:18px;
      box-shadow:0 6px 18px rgba(32,160,140,0.12);
    }
    h1{margin:0;font-size:18px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .grid{
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:18px;
      margin-top:16px;
    }

    /* left column: controls + list */
    .panel{
      background:var(--panel);
      padding:14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.02);
    }

    .controls{
      display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;
      align-items:center;
    }
    .controls input[type="text"], .controls input[type="number"]{
      background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px;color:inherit;
      outline:none; min-width:110px;
    }
    .controls button{
      background:var(--accent); border:none; padding:8px 12px; border-radius:8px; cursor:pointer;
      color:#052024; font-weight:600;
    }
    .controls .secondary{
      background:transparent;border:1px solid rgba(255,255,255,0.06); color:var(--muted); font-weight:600;
    }

    .proc-list{display:flex;flex-direction:column;gap:10px; margin-top:6px; max-height:360px; overflow:auto; padding-right:6px;}

    .proc {
      display:flex; align-items:center; gap:12px; padding:10px; border-radius:10px;
      background: linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      border:1px solid rgba(255,255,255,0.02);
    }
    .proc .meta{flex:1; min-width:0}
    .proc .meta .title{font-weight:700}
    .proc .meta .sub{font-size:12px;color:var(--muted); margin-top:4px}
    .proc .actions button{background:transparent;border:none;color:var(--muted);cursor:pointer;padding:6px;border-radius:8px}
    .proc .bar{height:8px;background:rgba(255,255,255,0.03);border-radius:8px;margin-top:8px;overflow:hidden}
    .proc .bar > i{display:block;height:100%; width:0%; background:linear-gradient(90deg,var(--accent), #60A5FA); border-radius:8px; transition:width 0.2s linear}

    /* right column: log & summary */
    .log {
      display:flex;flex-direction:column; gap:10px;
    }
    .log .box{background:var(--panel); padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.02);}
    .log .output{background:transparent; color:var(--muted); font-family: monospace; font-size:13px; max-height:300px; overflow:auto; padding:8px; border-radius:6px; border:1px dashed rgba(255,255,255,0.02)}
    .summary{display:flex;flex-direction:column;gap:8px}
    .summary .stat{display:flex;justify-content:space-between; color:var(--muted); font-size:14px}
    .summary .stat strong{color:var(--accent);}

    .hint{font-size:12px;color:var(--muted); margin-top:6px}

    footer{margin-top:14px; display:flex; justify-content:space-between; align-items:center; color:var(--muted); font-size:13px;}
    .btn-danger{background:var(--danger);border:none;padding:8px 10px;border-radius:8px;color:#2B0A10; font-weight:700;cursor:pointer}
    .btn-secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:var(--muted);cursor:pointer}

    @media (max-width:920px){
      .grid{grid-template-columns:1fr; }
      .logo{display:none}
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Simulasi Parbegin Parend">
    <header>
      <div class="logo">PB</div>
      <div>
        <h1>Simulasi Parbegin‚ÄìParend</h1>
        <p class="lead">Jalankan beberapa proses secara paralel dan lihat progress / waktu total.</p>
      </div>
    </header>

    <div class="grid">
      <!-- left -->
      <div>
        <div class="panel">
          <div class="controls" aria-hidden="false">
            <input id="procName" type="text" placeholder="Nama proses (mis: P1)" />
            <input id="procDur" type="number" min="0.1" step="0.1" placeholder="Durasi (detik)" />
            <button id="addBtn">+ Tambah</button>
            <button id="clearBtn" class="secondary">Clear Semua</button>
          </div>

          <div class="hint">Tambahkan proses lalu tekan <strong>Start Parbegin</strong>. Masing-masing proses berjalan "bersamaan" (dengan timer JS).</div>

          <div class="proc-list" id="procList" aria-live="polite"></div>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button id="startBtn" style="flex:1">Start Parbegin</button>
            <button id="stopBtn" class="btn-secondary" style="width:110px">Stop</button>
          </div>
        </div>

        <div class="panel" style="margin-top:12px">
          <h3 style="margin:0 0 8px 0">Pengaturan Cepat</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="preset1" class="secondary">3 Proses (2,3,4s)</button>
            <button id="preset2" class="secondary">5 Proses Random</button>
            <button id="preset3" class="secondary">Hapus log</button>
          </div>
        </div>
      </div>

      <!-- right -->
      <div class="log">
        <div class="box">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <strong>Output Log</strong>
            <div style="font-size:12px;color:var(--muted)">Real-time events</div>
          </div>
          <div id="logOutput" class="output" aria-live="polite"></div>
        </div>

        <div class="box summary">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>Ringkasan</strong>
            <small style="color:var(--muted)">Status</small>
          </div>
          <div class="stat"><span>Jumlah proses</span><strong id="statCount">0</strong></div>
          <div class="stat"><span>Durasi maksimal (s)</span><strong id="statMax">0</strong></div>
          <div class="stat"><span>Status</span><strong id="statState">Idle</strong></div>
          <div class="stat"><span>Total waktu (s)</span><strong id="statTotal">-</strong></div>
        </div>
      </div>
    </div>

    <footer>
      <div>Made for UAS ‚Äî Simulasi Parbegin</div>
      <div>
        <button id="exportBtn" class="btn-secondary">Export Log</button>
        <button id="resetBtn" class="btn-danger">Reset</button>
      </div>
    </footer>
  </div>

  <script>
    // Simple model: processes list, each {id,name,duration,status,progress}
    const procListEl = document.getElementById('procList');
    const logEl = document.getElementById('logOutput');
    const statCount = document.getElementById('statCount');
    const statMax = document.getElementById('statMax');
    const statState = document.getElementById('statState');
    const statTotal = document.getElementById('statTotal');

    const procNameInput = document.getElementById('procName');
    const procDurInput = document.getElementById('procDur');
    const addBtn = document.getElementById('addBtn');
    const clearBtn = document.getElementById('clearBtn');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const preset1 = document.getElementById('preset1');
    const preset2 = document.getElementById('preset2');
    const preset3 = document.getElementById('preset3');
    const exportBtn = document.getElementById('exportBtn');
    const resetBtn = document.getElementById('resetBtn');

    let processes = [];
    let running = false;
    let controller = { cancel:false };

    function uid(){ return Math.random().toString(36).slice(2,9); }

    function renderList(){
      procListEl.innerHTML = '';
      processes.forEach(p=>{
        const el = document.createElement('div');
        el.className = 'proc';
        el.dataset.id = p.id;
        el.innerHTML = `
          <div class="meta">
            <div class="title">${p.name} <small style="color:var(--muted);font-weight:600">(${p.duration}s)</small></div>
            <div class="sub">Status: <span class="st">${p.status}</span></div>
            <div class="bar"><i style="width:${p.progress}%"></i></div>
          </div>
          <div class="actions">
            <button class="btn-edit" title="Edit">‚úè</button>
            <button class="btn-remove" title="Remove">üóë</button>
          </div>
        `;
        procListEl.appendChild(el);

        el.querySelector('.btn-remove').addEventListener('click', ()=>{
          processes = processes.filter(x=>x.id!==p.id);
          log(Removed ${p.name});
          updateStats();
          renderList();
        });
        el.querySelector('.btn-edit').addEventListener('click', ()=>{
          const newName = prompt('Nama proses:', p.name);
          const newDur = prompt('Durasi (detik):', p.duration);
          if(newName!==null && newName.trim()!=='') p.name = newName.trim();
          const nd = parseFloat(newDur);
          if(!isNaN(nd) && nd>0) p.duration = nd;
          renderList();
          updateStats();
        });
      });
    }

    function addProcess(name, duration){
      const p = { id: uid(), name: name || P${processes.length+1}, duration: Number(duration) || 1, status:'idle', progress:0, startedAt:null, finishedAt:null };
      processes.push(p);
      log(Added ${p.name} (${p.duration}s));
      renderList();
      updateStats();
    }

    addBtn.addEventListener('click', ()=>{
      const name = procNameInput.value.trim();
      const dur = parseFloat(procDurInput.value);
      if(!name){ procNameInput.focus(); return }
      if(isNaN(dur) || dur <= 0){ procDurInput.focus(); return }
      addProcess(name, dur);
      procNameInput.value = '';
      procDurInput.value = '';
    });

    clearBtn.addEventListener('click', ()=>{
      if(confirm('Hapus semua proses?')) {
        processes = [];
        renderList();
        log('Cleared all processes.');
        updateStats();
      }
    });

    preset1.addEventListener('click', ()=> {
      processes = [];
      addProcess('P1',2); addProcess('P2',3); addProcess('P3',4);
      renderList(); updateStats();
    });
    preset2.addEventListener('click', ()=>{
      processes = [];
      for(let i=1;i<=5;i++) addProcess('P'+i, Math.round((Math.random()*4+1)*10)/10);
      renderList(); updateStats();
    });
    preset3.addEventListener('click', ()=> { logEl.innerHTML = ''; log('Log cleared.'); });

    // Logging helper
    function log(txt){
      const time = new Date().toLocaleTimeString();
      const line = [${time}] ${txt};
      const node = document.createElement('div');
      node.textContent = line;
      logEl.appendChild(node);
      logEl.scrollTop = logEl.scrollHeight;
    }

    function updateStats(){
      statCount.textContent = processes.length;
      statMax.textContent = processes.length ? Math.max(...processes.map(p=>p.duration)) : 0;
      statState.textContent = running ? 'Running' : 'Idle';
    }

    // Simulate "parallel" execution using Promises + setInterval progress
    async function runParbegin(){
      if(running) return;
      if(processes.length === 0){ alert('Belum ada proses. Tambah dulu.'); return; }

      running = true;
      controller.cancel = false;
      updateStats();
      statTotal.textContent = '-';
      log('=== PARBEGIN START ===');

      // reset statuses
      processes.forEach(p=>{ p.status='queued'; p.progress=0; p.startedAt=null; p.finishedAt=null; });

      renderList();

      const startT = performance.now();
      const tasks = processes.map(p => runProcessSim(p, controller));
      // Wait for all to finish (parend)
      await Promise.all(tasks);
      const endT = performance.now();

      if(!controller.cancel){
        log('=== PAREND: Semua proses selesai ===');
        const totalSec = ((endT - startT)/1000).toFixed(2);
        statTotal.textContent = totalSec;
        log(Total waktu (realtime): ${totalSec}s);
      } else {
        log('=== PAREND: Dibatalkan oleh user ===');
      }

      running = false;
      updateStats();
    }

    // Simulate one process: update progress every 100ms, finish after duration
    function runProcessSim(p, controllerRef){
      return new Promise(resolve=>{
        p.status = 'running';
        p.startedAt = Date.now();
        log(${p.name} dimulai (durasi ${p.duration}s));
        renderList();

        const totalMs = Math.max(1, Math.round(p.duration*1000));
        const tick = 100; // ms
        const steps = Math.ceil(totalMs / tick);
        let step = 0;

        // progress updater
        const iv = setInterval(()=>{
          if(controllerRef.cancel){
            clearInterval(iv);
            p.status = 'cancelled';
            p.progress = 0;
            p.finishedAt = Date.now();
            renderList();
            log(${p.name} dibatalkan);
            resolve();
            return;
          }
          step++;
          p.progress = Math.min(100, Math.round((step/steps)*100));
          renderList();
        }, tick);

        // completion
        setTimeout(()=>{
          clearInterval(iv);
          p.progress = 100;
          p.status = 'done';
          p.finishedAt = Date.now();
          renderList();
          const elapsed = ((p.finishedAt - p.startedAt)/1000).toFixed(2);
          log(${p.name} selesai (elapsed ${elapsed}s));
          resolve();
        }, totalMs);
      });
    }

    startBtn.addEventListener('click', ()=>{
      if(running){ alert('Simulasi sedang berjalan'); return; }
      runParbegin();
      updateStats();
    });

    stopBtn.addEventListener('click', ()=>{
      if(!running){ alert('Tidak ada simulasi berjalan'); return; }
      if(confirm('Hentikan simulasi sekarang?')) {
        controller.cancel = true;
        statState.textContent = 'Stopping...';
      }
    });

    exportBtn.addEventListener('click', ()=>{
      // export log as text
      const txt = Array.from(logEl.children).map(n=>n.textContent).join("\n");
      const blob = new Blob([txt], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'parbegin_log.txt';
      a.click();
      URL.revokeObjectURL(url);
    });

    resetBtn.addEventListener('click', ()=>{
      if(!confirm('Reset aplikasi (hapus semua proses & log)?')) return;
      processes = [];
      logEl.innerHTML = '';
      renderList();
      updateStats();
      statTotal.textContent = '-';
      log('System reset.');
    });

    // initial state
    updateStats();

    // small usability: double enter to add
    procDurInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') addBtn.click(); });
    procNameInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') procDurInput.focus(); });

    // for demo convenience add 3 default processes
    addProcess('P1', 2);
    addProcess('P2', 3);
    addProcess('P3', 4);
  </script>
</body>
</html>